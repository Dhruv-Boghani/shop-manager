<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Products - MyShop</title>
  <link rel="stylesheet" href="/css/product.css"> <!-- Link to custom CSS -->
  <link rel="stylesheet" href="/css/navbar.css"> <!-- Link to custom CSS -->
  <link rel="stylesheet" href="/css/popup.css"> <!-- Link to custom CSS -->
</head>
<body>
  <%- include('../partials/navbar') %>
  <%- include('../partials/popupProduct') %>

  <div class="product-container">
    <div class="header">
      <h2>All Products</h2>
      <a href="/product/add" class="add-product-btn">+ Add Product</a>
    </div>

    <form class="search-form" method="GET" action="/product">
      <input type="text" name="search" class="search-input" placeholder="Search by name or SKU..." />
    </form>

    <% if (products.length === 0) { %>
      <div class="alert alert-warning">No products found!</div>
    <% } else { %>
      <div class="table-container">
        <table class="product-table">
          <thead>
            <tr>
              <th>SKU</th>
              <th>Name</th>
              <th>Buy Price</th>
              <th>Sale Price</th>
              <th>Description</th>
              <th>Actions</th> <!-- New column -->
            </tr>
          </thead>
          <tbody>
            <% products.forEach(product => { %>
              <tr>
                <td><%= product.productSKU %></td>
                <td><%= product.name %></td>
                <td>₹<%= product.buyPrice %></td>
                <td>₹<%= product.salePrice %></td>
                <td><%= product.description %></td>
                <td>
                  <a href="/product/edit/<%= product._id %>" class="edit-btn">Edit</a>
                  <form id="deleteForm-<%= product._id %>" action="/product/delete/<%= product._id %>" method="POST" onsubmit="return false;" class="delete-form">
                    <button type="button" class="delete-btn no-loader" onclick="openDeleteModal('<%= product._id %>')">Delete</button>
                  </form>                  
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

  <script src="/js/script.js"></script> <!-- Add custom JS if needed -->
  <script>
    let currentDeleteFormId = null;
    
    function openDeleteModal(billId) {
      currentDeleteFormId = `deleteForm-${billId}`;
      document.getElementById('deleteModal').style.display = 'block';
    }
    
    function closeDeleteModal() {
      document.getElementById('deleteModal').style.display = 'none';
      currentDeleteFormId = null;
    }
    
    document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
      if (currentDeleteFormId) {
        document.getElementById(currentDeleteFormId).submit();
      }
    });
    </script>
    
</body>
</html>
